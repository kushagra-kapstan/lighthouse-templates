{
  "$schema": "https://schema.management.azure.com/schemas/2019-08-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
   "mspOfferName": {
    "type": "string",
    "metadata": {
     "description": "Specify a unique name for your offer"
    },
    "defaultValue": "Kapstan Access"
   },
   "mspOfferDescription": {
    "type": "string",
    "metadata": {
     "description": "Name of the Managed Service Provider offering"
    },
    "defaultValue": "Test ARM Template for Kapstan Access"
   }
  },
  "variables": {
   "mspRegistrationName": "[guid(parameters('mspOfferName'))]",
   "mspAssignmentName": "[guid(parameters('mspOfferName'))]",
   "managedByTenantId": "80fb1a74-b9d6-453c-970c-529f60a6eca6",
   "authorizations": [
    {
     "principalId": "0dc71ecf-ea3b-4ce6-b2f3-026c683d71ce",
     "roleDefinitionId": "b24988ac-6180-42a0-ab88-20f7382dd24c",
     "principalIdDisplayName": "kushagra-local-arm-auth"
    }
   ]
  },
  "resources": [
   {
    "type": "Microsoft.ManagedServices/registrationDefinitions",
    "apiVersion": "2020-02-01-preview",
    "name": "[variables('mspRegistrationName')]",
    "properties": {
     "registrationDefinitionName": "[parameters('mspOfferName')]",
     "description": "[parameters('mspOfferDescription')]",
     "managedByTenantId": "[variables('managedByTenantId')]",
     "authorizations": "[variables('authorizations')]"
    }
   },
   {
    "type": "Microsoft.ManagedServices/registrationAssignments",
    "apiVersion": "2020-02-01-preview",
    "name": "[variables('mspAssignmentName')]",
    "dependsOn": [
     "[resourceId('Microsoft.ManagedServices/registrationDefinitions/', variables('mspRegistrationName'))]"
    ],
    "properties": {
     "registrationDefinitionId": "[resourceId('Microsoft.ManagedServices/registrationDefinitions/', variables('mspRegistrationName'))]"
    }
   }
  ],
  "outputs": {
   "mspOfferName": {
    "type": "string",
    "value": "[concat('Managed by', ' ', parameters('mspOfferName'))]"
   },
   "authorizations": {
    "type": "array",
    "value": "[variables('authorizations')]"
   }
  }
 }